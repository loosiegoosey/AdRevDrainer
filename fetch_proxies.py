import random
import logging
import certifi
import requests

# List of user agents to rotate
USER_AGENTS = [
    "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.114 Safari/537.36",
    "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:89.0) Gecko/20100101 Firefox/89.0",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:89.0) Gecko/20100101 Firefox/89.0",
    "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:87.0) Gecko/20100101 Firefox/87.0",
]

# Provided list of proxies
PROXIES = [
    "104.207.43.119:3128", "104.167.26.235:3128", "104.167.31.222:3128", "104.167.26.72:3128",
    "104.207.34.211:3128", "104.207.34.92:3128", "104.207.52.205:3128", "104.207.41.203:3128",
    "104.207.36.133:3128", "104.207.49.194:3128", "104.207.47.78:3128", "104.207.54.82:3128",
    "104.207.51.11:3128", "104.207.55.92:3128", "104.207.62.121:3128", "104.207.51.130:3128",
    "104.207.38.20:3128", "104.207.60.157:3128", "104.207.61.76:3128", "104.207.63.110:3128",
    "104.207.49.86:3128", "104.167.26.35:3128", "104.207.57.75:3128", "104.207.49.227:3128",
    "104.207.48.48:3128", "104.207.40.80:3128", "104.207.52.94:3128", "104.167.30.133:3128",
    "104.207.42.35:3128", "104.207.56.210:3128", "104.207.49.249:3128", "104.207.32.52:3128",
    "104.207.49.47:3128", "104.207.54.42:3128", "104.207.54.94:3128", "104.167.31.102:3128",
    "104.207.55.199:3128", "104.207.58.61:3128", "104.207.45.213:3128", "104.207.46.92:3128",
    "104.167.24.41:3128", "104.207.53.102:3128", "104.207.49.102:3128", "104.167.29.153:3128",
    "104.207.38.134:3128", "104.207.54.69:3128", "104.167.26.221:3128", "104.207.34.40:3128",
    "104.207.33.241:3128", "104.207.44.150:3128", "104.167.29.94:3128", "104.207.56.4:3128",
    "104.207.36.167:3128", "104.207.37.79:3128", "104.207.37.101:3128", "104.207.56.29:3128",
    "104.207.35.23:3128", "104.207.63.145:3128", "104.207.61.206:3128", "104.207.40.153:3128",
    "104.167.24.164:3128", "104.207.51.218:3128", "104.207.37.22:3128", "104.167.26.183:3128",
    "104.207.52.178:3128", "104.207.63.181:3128", "104.167.25.173:3128", "104.207.37.87:3128",
    "104.207.36.135:3128", "104.207.36.112:3128", "104.207.45.127:3128", "104.167.27.202:3128",
    "104.207.57.184:3128", "104.207.51.184:3128", "104.167.27.138:3128", "104.207.37.159:3128",
    "104.207.63.41:3128", "104.207.58.20:3128", "104.167.27.77:3128", "104.207.42.61:3128",
    "104.207.50.220:3128", "104.167.28.99:3128", "104.207.40.169:3128", "104.207.43.151:3128",
    "104.167.30.68:3128", "104.167.27.72:3128", "104.207.60.50:3128", "104.207.44.241:3128",
    "104.207.36.154:3128", "104.167.28.246:3128", "104.207.59.93:3128", "104.207.32.145:3128",
    "104.207.50.134:3128", "104.207.54.99:3128", "104.207.46.213:3128", "104.207.47.218:3128",
    "104.207.37.127:3128", "104.207.43.237:3128", "104.207.53.222:3128", "104.207.58.133:3128"
]

def get_random_user_agent():
    return random.choice(USER_AGENTS)

def validate_proxy(proxy):
    headers = {"User-Agent": get_random_user_agent()}
    try:
        response = requests.get("https://httpbin.org/ip", proxies={"http": f"http://{proxy}", "https": f"http://{proxy}"}, timeout=5, headers=headers, verify=certifi.where())
        return response.status_code == 200
    except requests.exceptions.RequestException as e:
        logging.error(f"Proxy {proxy} failed during validation. Error: {e}")
        return False

def get_next_valid_proxy(proxies):
    for proxy in proxies:
        if validate_proxy(proxy):
            return proxy
    return None
